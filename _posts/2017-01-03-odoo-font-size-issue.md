---
layout: post
title: 更換Server后，用QWEB產生出來的PDF中文字及圖片大小有差異
---

最近執行了Odoo8的Server遷移，從Azure遷移到了Amazon，但是發現遷移后產出的PDF字體都變大，造成原本的版面被提早翻頁，使用者抱怨這樣會浪費紙張。

### Odoo QWEB產出的PDF尺寸問題

* 首先檢查了wqy-microhei的字形文件，確認兩台Server的版本及文件大小完全一致
* 再來檢查Odoo中的系統設定，確認使用的是相同字體（其實將資料庫匯出匯入，這裡應該是不會有差異的）
* 正當一頭霧水找不到北的時候，印出了兩個版本的PDF來截圖準備求助的時候，發現除了文字大小之外圖片也有大小差異，因此確認可排除字形的問題
* 因Odoo使用wkhtmltopdf來列印PDF，因此下指令wkhtmltopdf -V來比對兩台server的版本，果然發現差異，原因是舊的那台Server不是我安裝的，所以安裝的wkhtmltopdf版本有差異，分別是12.0.1和12.0.3，更換為相同版本后，再進行測試確認兩台Server印出的PDF大小已保持一致

一個微小的版本差異往往會很難找到原因，此問題一位同好也遇到過，當時他未找到此根因，因而修改所有的qweb來強制調整文字大小才解決掉。因此對這類基礎lib的版本差異應特別注意。